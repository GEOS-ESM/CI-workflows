name: Set up Swell

on: workflow_call

jobs:
  swell-tier_1-setup:

    runs-on: nccs-discover
    timeout-minutes: 30

    steps:
      - name: validate-workflow
        run: |
          /home/jardizzo/bin/nams_check.py ${{ github.triggering_actor }} swell

      - name: acquire-swell
        uses: actions/checkout@v3

      - name: install-swell
        run: |
          # Make experiment directory
          mkdir /discover/nobackup/gmao_ci/swell/tier1/${GITHUB_RUN_ID}

          # Copy and source modules
          cp ${GITHUB_WORKSPACE}/src/swell/deployment/platforms/nccs_discover/modules /discover/nobackup/gmao_ci/swell/tier1/${GITHUB_RUN_ID}/
          source /discover/nobackup/gmao_ci/swell/tier1/${GITHUB_RUN_ID}/modules
          pip install --prefix=/discover/nobackup/gmao_ci/swell/tier1/${GITHUB_RUN_ID}/swell -r ${GITHUB_WORKSPACE}/requirements.txt --no-cache-dir ${GITHUB_WORKSPACE}
